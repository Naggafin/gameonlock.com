{% extends 'base.html' %}
{% load static i18n socialaccount %}
{% block js %}
    {{ block.super }}
    <script nonce="{{ request.csp_nonce }}">
document.addEventListener('DOMContentLoaded', () => {
    const processingSteps = document.querySelector('.processing-steps');
    const poklottoForm = document.querySelector('#poklotto_register_form');
    const headingTitle = document.querySelector('h3.steps-heading-title');

    window.addEventListener('scroll', () => {
        const offsetTop = poklottoForm.offsetTop;
        if (window.scrollY > offsetTop) {
            processingSteps.classList.add('top-fixed', 'animate__animated', 'animate__fadeInDown');
            headingTitle.classList.add('steps-heading-fixed');
        } else {
            processingSteps.classList.remove('top-fixed', 'animate__fadeInDown');
            headingTitle.classList.remove('steps-heading-fixed');
        }
    });
});
    </script>
{% endblock %}
{% block banner %}
    <div class="prd-breadcrumb">
        <div class="brd-shape">
            <div class="brd-img brd-img-1"
                 data-aos="fade-right"
                 data-aos-delay="200"
                 data-aos-duration="500"
                 data-aos-easing="ease-in">
                <img src="{% static 'peredion/images/breadcrumb/brd-img-1.png' %}"
                     alt=""
                     nonce="{{ request.csp_nonce }}">
            </div>
            <div class="brd-img brd-img-2"
                 data-aos="fade-left"
                 data-aos-delay="200"
                 data-aos-duration="500"
                 data-aos-easing="ease-in">
                <img src="{% static 'peredion/images/breadcrumb/brd-img-2.png' %}"
                     alt=""
                     nonce="{{ request.csp_nonce }}">
            </div>
        </div>
        <div class="container">
            <div class="brd-content">
                <div data-aos="fade-up"
                     data-aos-delay="200"
                     data-aos-duration="500"
                     data-aos-easing="ease-in">
                    <span class="sub-title">{% trans "Sign Up" %}</span>
                </div>
                <h2 class="title"
                    data-aos="fade-up"
                    data-aos-delay="350"
                    data-aos-duration="500"
                    data-aos-easing="ease-in">{% trans "Sign up to create an account" %}</h2>
                <div class="page-direction">
                    <ul>
                        <li>
                            <span class="icon"><i class="fa-solid fa-house"></i></span>
                            <a href="/" class="text">{% trans "Home" %}</a>
                        </li>
                        <li>
                            <span class="icon"><i class="fa-light fa-caret-right fa-xl"></i></span>
                            <span class="text">{% trans "Sign Up" %}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block content %}
    <div class="sign-up">
        <div class="global-shape style-3">
            <img src="{% static 'peredion/images/shapes/shape-1.png' %}"
                 alt=""
                 data-aos="fade-left"
                 data-aos-duration="500"
                 data-aos-offset="200"
                 data-aos-easing="ease-in"
                 data-aos-delay="400"
                 nonce="{{ request.csp_nonce }}">
        </div>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-xl-8 col-lg-9 col-md-11">
                    <div class="processing-steps">
                        <div class="single-steps first-step current-step"
                             data-aos="fade-up"
                             data-aos-delay="150"
                             data-aos-duration="500"
                             data-aos-easing="ease-in">
                            <div class="part-icon">
                                <img src="{% static 'peredion/images/register/step-1.png' %}"
                                     alt=""
                                     nonce="{{ request.csp_nonce }}">
                            </div>
                            <div class="part-text">
                                <span class="step-line-title">{% trans "Basic Info" %}</span>
                            </div>
                        </div>
                        <div class="arrow-img"
                             data-aos="fade-right"
                             data-aos-delay="150"
                             data-aos-duration="500"
                             data-aos-easing="ease-in">
                            <img src="{% static 'peredion/images/register/arrow-1.png' %}"
                                 alt=""
                                 class="arrow-icon"
                                 nonce="{{ request.csp_nonce }}">
                        </div>
                        <div class="single-steps second-step"
                             data-aos="fade-up"
                             data-aos-delay="200"
                             data-aos-duration="500"
                             data-aos-easing="ease-in">
                            <div class="part-icon">
                                <img src="{% static 'peredion/images/register/step-2.png' %}"
                                     alt=""
                                     nonce="{{ request.csp_nonce }}">
                            </div>
                            <div class="part-text">
                                <span class="step-line-title">{% trans "Personal Details" %}</span>
                            </div>
                        </div>
                        <div class="arrow-img second"
                             data-aos="fade-right"
                             data-aos-delay="200"
                             data-aos-duration="500"
                             data-aos-easing="ease-in">
                            <img src="{% static 'peredion/images/register/arrow-2.png' %}"
                                 alt=""
                                 class="arrow-icon"
                                 nonce="{{ request.csp_nonce }}">
                        </div>
                        <div class="single-steps third-step"
                             data-aos="fade-up"
                             data-aos-delay="250"
                             data-aos-duration="500"
                             data-aos-easing="ease-in">
                            <div class="part-icon">
                                <img src="{% static 'peredion/images/register/step-3.png' %}"
                                     alt=""
                                     nonce="{{ request.csp_nonce }}">
                            </div>
                            <div class="part-text">
                                <span class="step-line-title">{% trans "Contact Info" %}</span>
                            </div>
                        </div>
                        <div class="arrow-img"
                             data-aos="fade-right"
                             data-aos-delay="250"
                             data-aos-duration="500"
                             data-aos-easing="ease-in">
                            <img src="{% static 'peredion/images/register/arrow-1.png' %}"
                                 alt=""
                                 class="arrow-icon"
                                 nonce="{{ request.csp_nonce }}">
                        </div>
                        <div class="single-steps last-step"
                             data-aos="fade-up"
                             data-aos-delay="300"
                             data-aos-duration="500"
                             data-aos-easing="ease-in">
                            <div class="part-icon">
                                <img src="{% static 'peredion/images/register/step-4.png' %}"
                                     alt=""
                                     nonce="{{ request.csp_nonce }}">
                            </div>
                            <div class="part-text">
                                <span class="step-line-title">{% trans "Security & Confirmation" %}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-xl-10 col-lg-10"
                     data-aos="fade-up"
                     data-aos-delay="100"
                     data-aos-duration="500"
                     data-aos-easing="ease-in">
                    <div class="poklotto-form"
                         id="poklotto_register_form"
                         x-data="registerForm">
                        <h3 class="steps-heading-title title" x-text="steps[currentStep].title"></h3>
                        <div class="part-form">
                            <form method="post"
                                  action="{% url 'account_signup' %}"
                                  @submit.prevent="submitForm">
                                {% csrf_token %}
                                {% if form.errors %}
                                    <div class="alert alert-danger">
                                        {% for error in form.non_field_errors %}{{ error }}{% endfor %}
                                        {% for field in form %}
                                            {% if field.errors %}
                                                {% for error in field.errors %}<p>{{ field.label }}: {{ error }}</p>{% endfor %}
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-all-step">
                                    <!-- Step 1: Basic Info -->
                                    <div class="first-step-form per-step animate__animated"
                                         :class="{ 'blanked': currentStep === 0 }">
                                        <div class="row">
                                            <div class="col-xl-6 col-lg-6 col-md-6">
                                                <label for="id_username" class="form-label">
                                                    <span>{% trans "Username" %}</span>
                                                </label>
                                                {{ form.username }}
                                            </div>
                                            <div class="col-xl-6 col-lg-6 col-md-6">
                                                <label for="id_email" class="form-label">
                                                    <span>{% trans "Email Address" %}</span>
                                                </label>
                                                {{ form.email }}
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Step 2: Personal Details -->
                                    <div class="second-step-form per-step animate__animated"
                                         :class="{ 'blanked': currentStep === 1 }">
                                        <div class="row">
                                            <div class="col-xl-6 col-lg-6 col-md-6">
                                                <label for="id_state" class="form-label">
                                                    <span>{% trans "State" %}</span>
                                                </label>
                                                {{ form.state }}
                                            </div>
                                            <div class="col-xl-6 col-lg-6 col-md-6">
                                                <label for="id_date_of_birth" class="form-label">
                                                    <span>{% trans "Date of Birth" %}</span>
                                                </label>
                                                {{ form.date_of_birth }}
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Step 3: Contact Info -->
                                    <div class="third-step-form per-step animate__animated"
                                         :class="{ 'blanked': currentStep === 2 }">
                                        <div class="row">
                                            <div class="col-xl-6 col-lg-6 col-md-6">
                                                <label for="id_phone_number" class="form-label">
                                                    <span>{% trans "Phone Number" %}</span>
                                                </label>
                                                {{ form.phone_number }}
                                            </div>
                                            <div class="col-xl-6 col-lg-6 col-md-6">
                                                <label for="id_alternate_email_address" class="form-label">
                                                    <span>{% trans "Alternate Email Address" %}</span>
                                                </label>
                                                {{ form.alternate_email_address }}
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Step 4: Security & Confirmation -->
                                    <div class="fourth-step-form per-step animate__animated"
                                         :class="{ 'blanked': currentStep === 3 }">
                                        <div class="row">
                                            <div class="col-xl-6 col-lg-6 col-md-6">
                                                <label for="id_password1" class="form-label">
                                                    <span>{% trans "Password" %}</span>
                                                </label>
                                                {{ form.password1 }}
                                            </div>
                                            <div class="col-xl-6 col-lg-6 col-md-6">
                                                <label for="id_password2" class="form-label">
                                                    <span>{% trans "Confirm Password" %}</span>
                                                </label>
                                                {{ form.password2 }}
                                            </div>
                                            <div class="col-xl-12">
                                                <div class="agreement-article">
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input"
                                                               type="checkbox"
                                                               id="terms_confirm"
                                                               x-model="termsConfirmed">
                                                        <label class="form-check-label" for="terms_confirm">
                                                            {% blocktrans %}I agree to the <a href="#TODO">terms and conditions</a> to use this website{% endblocktrans %}
                                                        </label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input"
                                                               type="checkbox"
                                                               id="age_confirm"
                                                               x-model="ageConfirmed">
                                                        <label class="form-check-label" for="age_confirm">{% trans "I confirm I am at least 18 years old" %}</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-controller">
                                    <button class="prv-stp-btn"
                                            :class="{ 'disabled': currentStep === 0 }"
                                            @click="prevStep"
                                            type="button">
                                        <i class="fa-duotone fa-arrow-left"></i>
                                    </button>
                                    <button class="prd-btn-1"
                                            @click="nextStep"
                                            type="button"
                                            x-show="currentStep < 3">
                                        {% trans "Next Step" %} <i class="fa-duotone fa-arrow-right"></i>
                                    </button>
                                    <button class="prd-btn-1"
                                            type="submit"
                                            x-show="currentStep === 3"
                                            :disabled="!termsConfirmed || !ageConfirmed">
                                        {% trans "Sign Up" %} <i class="fa-duotone fa-arrow-right"></i>
                                    </button>
                                </div>
                            </form>
                            <div class="part-connect-social-info">
                                <div class="title-overlap">
                                    <h4 class="title">{% trans "Or Sign Up With" %}</h4>
                                </div>
                                <ul>
                                    <li>
                                        <a href="{% provider_login_url 'google' %}"
                                           class="single-social s-pinterest">
                                            <i class="fa-brands fa-google"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="{% provider_login_url 'facebook' %}"
                                           class="single-social s-facebook">
                                            <i class="fa-brands fa-facebook-f"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="{% provider_login_url 'twitter' %}"
                                           class="single-social s-twitter">
                                            <i class="fa-brands fa-twitter"></i>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            document.addEventListener('alpine:init', () => {
                Alpine.data('registerForm', () => ({
                    currentStep: 0,
                    termsConfirmed: false,
                    ageConfirmed: false,
                    steps: [
                        { title: '{% trans "Basic Info" %}' },
                        { title: '{% trans "Personal Details" %}' },
                        { title: '{% trans "Contact Info" %}' },
                        { title: '{% trans "Security & Confirmation" %}' }
                    ],
                    nextStep(event) {
                        if (this.currentStep < 3) {
                            this.currentStep++;
                            this.updateStepVisibility();
                        }
                    },
                    prevStep(event) {
                        if (this.currentStep > 0) {
                            this.currentStep--;
                            this.updateStepVisibility();
                        }
                    },
                    updateStepVisibility() {
                        document.querySelectorAll('.per-step').forEach((el, index) => {
                            el.classList.remove('blanked', 'animate__fadeInRight', 'animate__fadeOutLeft');
                            if (index === this.currentStep) {
                                el.classList.add('blanked', 'animate__fadeInRight');
                            } else if (index < this.currentStep) {
                                el.classList.add('animate__fadeOutLeft');
                            }
                        });
                        document.querySelectorAll('.single-steps').forEach((el, index) => {
                            el.classList.toggle('current-step', index <= this.currentStep);
                        });
                        document.querySelectorAll('.arrow-img').forEach((el, index) => {
                            el.classList.toggle('current-arrow', index < this.currentStep);
                        });
                    },
                    submitForm(event) {
                        if (this.termsConfirmed && this.ageConfirmed) {
                            event.target.submit();
                        }
                    }
                }));
            });
        </script>
    </div>
{% endblock %}
